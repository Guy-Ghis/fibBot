name: "Run FibBot"

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize]

permissions:
  pull-requests: write
  contents: read

jobs:
  run-fibbot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run FibBot
        uses: Guy-Ghis/fibBot@main

      - name: Get PR number and body
        id: pr-info
        uses: actions/github-script@v6
        with:
          script: |
            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number,
            });
            return {
              number: context.payload.pull_request.number,
              body: pr.body || "",
            };
            - name: Run Rust code
            run: |
              docker run --rm my-rust-app \
                --pr-number ${{ steps.pr-info.outputs.number }} \
                --pr-body "${{ steps.pr-info.outputs.body }}" \
                --github-token ${{ secrets.GITHUB_TOKEN }}
    
          # Post the result as a comment on the PR
      - name: Post comment on PR
        uses: actions/github-script@v6
        with:
              script: |
                const { data: comment } = await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: ${{ steps.pr-info.outputs.number }},
                  body: `Fibonacci results:\n${process.env.FIB_RESULTS}`,
                });